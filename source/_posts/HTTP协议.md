---
title: HTTP协议
date: 2018-05-11 18:42:51
tags:
categories:
- 网络学习
- 应用层
---

此篇博客的主要内容来讲解一下HTTP协议。


首先在讲解HTTP协议之前先补充一下万维网WWW（world,wide,web）的相关知识.

万维网组成：主要由网页组成，还有就是网页之间的互相连接。
<!--more-->
网页的内容又是什么呢？

网页包含多个对象：HTML文件、图片、视频、动态脚本，每个网页还有一个基本的HTML文件包含对其他对象的引用。

Web对象的寻址（URL）：使用URL统一资源定位器

固定格式:<协议>://<主机>:<端口>/<路径>

协议：就是指用什么协议来获取该万维网文档。现在最常用的就是http协议（超文本传输协议），其次是ftp（文件传输协议）。在协议后面的://是规定的格式

主机：指出万维网文档在哪个主机上，这里可以是主机ip也可以是域名，后面的端口和路径有时候可以省略。

举个例子：

	www.lishuaii.com/test/pic.gif

## HTTP(超文本传输协议)

下面进入超文本传输协议的介绍，首先介绍一些基础知识，然后在介绍HTTP协议的格式吧。。

http的操作过程：http定义了浏览器（即万维网客户进程）怎么向万维网服务器求情万维网文档，以及服务器怎么样把文档传给浏览器。从层次角度看HTTP是面向事物的（所谓事物就是指一系列信息的交换，而这一系列信息的交换是一个不可分割的整体，也就是说要么所有的信息都交换完，要么一次都不进行）应用层协议。HTTP不仅传输超文本跳转所必须的信息，而且也传送任何从互联网上得到的信息，如文本、超文本、声音、图像等。

版本：http1.0和http1.1

下面讲一下http使用tcp的一次传输过程？：

1.服务器在80端口等待客户端的连接请求

2.浏览器发起到服务器的TCP连接（创建socket套接字，建立三次握手）

3.服务器接收来自浏览器的TCP连接

4.浏览器（HTTP客户端）与Web服务器（HTTP服务器）交换HTTP消息

5.关闭TCP连接。

注意：http应用协议是一个无状态的协议，即服务器不维护任何有关客户端过去所发请求得信息。为什么使用无状态呢？因为成本低，问题少。

http的连接类型？

1.非持久性性连接：每个TCP连接最多允许传输一个对象。HTTP 1.0版本使用非持久性连接（短连接）

2.持久性连接：每个TCP连接允许传输多个对象。HTTP1.1版本默认使用持久性连接（长连接）

下面详细介绍两个连接方式的工作过程

1.非持久性连接：

![](https://i.imgur.com/gDnJfVn.jpg)

2.持久性连接

因为非持久性连接有很大的问题比如：

1.每个对象需要2个RTT

2.操作系统需要为每个TCP连接开销资源（overhead）

所以持久性连接就是在发送相应以后，服务器保持TCP连接的打开而不是直接关闭连接，后续的HTTP消息通过这个连接发送。
 

但是持久性连接又可以分为1.非流水线方式的持久性连接：即客户端只有收到前一个响应后才能发送新的请求，每个被引用的对象耗时一个RTT。2.流水线机制的持久性连接（HTTP1.1默认选项）：客户端只要遇到一个引用对象就尽快发出请求，理想情况下收到所有的对象只需要耗时约一个RTT。

好了接下来就来看看HTTP消息格式

## HTTP消息格式

HTTP有两类消息：请求消息（从客户向服务器发送请求报文）和相应消息（从服务器到客户端的回答）

1.请求消息

![](https://i.imgur.com/MKm6Y6J.jpg)

2.响应消息
![](https://i.imgur.com/OOekJB7.jpg)

致此关于HTTP基本的内容已经讲完了，下面再说两个扩展性的话题Cookie和代理服务器

## Cookie技术

为什么需要Cookie技术呢？

因为HTTP协议是一种无状态的，即服务器不记录客户的历史行为，那么就会带来一些问题，很多服务器需要记录客户的状态，购物车之类的。。


### Cookie工作原理:

当用户A浏览某个使用Cookie的网站的时候，该网站的服务器就会为A产生一个唯一的标识码，并以此作为索引在服务器的后端数据库中产生一个项目。接着在给A的响应报文的首部行中添加一个叫做Set-cookie的首部行，形如Set-cookie：识别码（123456或者fgdsgdfgsd）总之识别码是唯一的，那么这个网站就能跟踪客户A在该网站的活动，需要注意的是服务器并不知道这个用户的真实姓名以及其他的信息，但是服务器能够知道用户A在什么时候访问了哪些页面，以及页面的访问顺序。如果A是在网上购物，那么服务器就可以为A维护一个所购物品的列表，方便A一起付费。假如A过几天再次访问这个网站的话，那么他的请求报文中继续使用Set-cookie：识别码，这个时候网站可以根据其过去的访问记录给A提供相应的商品推荐。。如果A在该网站输入过个人信息的话，那么该网站也保存了用户的信息。。

![](https://i.imgur.com/UGunOd7.jpg)

## Web代理服务器技术（Web缓存技术）

功能：在用户浏览器不需要访问源服务器就能满足HTTP请求。

好处：缩小响应的时间、减少机构和组织的流量、在大范围内实现有效内容的分发。

### 技术的实现过程

假如不使用代理服务器的时候，局域网中的所有计算机都通过1.5Mbit/s的线路与互联网上的源点服务器建立TCP连接。所以会造成链路过载，延时大大增加。

![](https://i.imgur.com/6MUVXZl.jpg)

如果使用代理服务器的话

![](https://i.imgur.com/TsCczlc.jpg)

下面详细叙述一下整个访问的过程

1.局域网中的计算机的浏览器向互联网服务器请求服务时，就先和代理服务器建立TCP连接，并向代理服务器发出HTTP请求报文。

2.如果代理服务器已经存放了所请求得对象，代理服务器就把这个对象放入HTTP响应报文中返回给计算机的浏览器。

3.否则，代理服务器就代表发出请求得用户浏览器，与互联网上的源点服务器建立TCP连接，并发送HTTP请求报文。

4.源点服务器把所有的请求对象放在HTTP响应报文中返回给代理服务器。

5.代理服务器收到这个对象以后，先复制在自己本地的存储器中（留待以后使用），然后在吧这个对象放在HTTP响应报文中，通过已经建立的TCP连接，返回给请求该对象的浏览器。。

### 那么我们如何保证代理服务器上的页面就一定是最新的页面的呢？

![](https://i.imgur.com/1wvOFHx.jpg)