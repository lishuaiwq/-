---
title: UDP概述
date: 2018-03-29 19:46:53
tags: UDP
categories:
- 网络学习
- 传输层
---
此篇博客主要介绍传输层的主要协议之一：用户数据协议报UDP协议（无连接协议），在只是实现传输层最基本的功能，复用和分用还有差错检验的功能。

<!--more-->

UDP的特点：

1.UDP是无连接的：即发送数据之前不需要建立连接，当然发送数据结束的时候有也不需要断开或者释放连接，正因为这样减少了开销和发送数据之前的延迟。

2.UDP使用尽最大努力交付：即不保证可靠交付，因此主机里面不需要保存大量的维持连接状态的信息表（里面有很多参数）

3.UDP是面向报文的：即UDP对于从应用层拿到的报文或者从网络层接收到的报文及不拆分，也不合并，只是加头发送，去头向上传递，也就是说UDP一次交付一个完成的报文，所以应用程序必须自己选择合适的报文大小，因为选择的过于小了，到时候传递给IP层后会显得IP层的首部相对较大影响效率，如果选择的报文过大，则在IP层会发生IP切片。

4.UDP没有拥塞控制：所以当传输网路实现拥塞的时候，传输方的传输速率并不会降低，这对于一些实时的应用是很重要的（比如IP电话，即时视频会议等），其允许在网络拥塞是丢失部分数据，但是不允许有太大的延迟

5.UDP支持，1对1,1对多，多对1，多对多交互式通信

6.UDP的头部开销小：相对于TCP的20个字节来说。UDP头部只有八个字节。

下面给出UDP的协议报文图

![](https://i.imgur.com/kOq87Qx.jpg)

1.16位源端口号：在需要对方回信时选用，不需要时全为0.

2.16为目的端口号：在报文交付时必须使用

3.16位UDP长度：其最小值为8（只有头部）

4.检验和：检测UDP用户数据报在传输中是否有错，有错则丢弃。

注意：如果接受方的UDP发现收到的报文目的端口号不正确，即不存在向对应的应用程序，则丢弃该报文，同时由网际控制报文协议ICMP发送“端口不可达”差错报文给发送端。

注意：虽然在UDP通信时要用到端口号，但是由于UDP的通信是无连接的，因此不需要使用套接字（TCP之间的通信必须使用两个套接字建立连接）。


最后来说说UDP的差错检验和：

在计算UDP的差错检验和的时候需要给UDP报文加上一个伪头部，用来更好的验证差错，这个伪头部并不是UDP的头部，它只是为了计算校验和临时得到的，即不向上传送，也不向下传送。下面给出示意图

![](https://i.imgur.com/JgRAeAe.jpg)

UDP校验和的计算方法和IP的校验和相似，只不过IP的校验和仅仅是检验IP数据报首部的信息，而UDP校验和是检验首部和数据部分一起检验，检验其IP和端口号.

为什么需要伪头部？
伪头部的目的是为了让UDP包接受者确定发送和接受的UDP包是来自正确的源且是发给自己的。

但是收到的UDP包只有源和目的的UDP端口号，并没有IP地址信息，所以要重新构造个伪头部，加上源IP和目的IP（从IP包中拿来），再计算校验和以确定数据包的正确性。因为传输层和UDP和IP不一定在一个协议栈，IP层携带的数据不一定就要发送给UDP，所以UDP需要 确定就是发送给我的!

计算举例如下：

发送方首先把全零放入检验和中，然后将加上伪头部的UDP数据报看成由许多16位串起来的，如果UDP的数据报数据部分不是偶数字节的，则要填入全0字节，但是此字节不发送。然后将这些16位二进制求和，将最后的结果反码写入校验和。在接收端，重新计算校验和，如果没有差错结果为1.（因为只是校验和不同，和其对应的是反码，反码+源码=1）。

![](https://i.imgur.com/zy313RO.jpg)

